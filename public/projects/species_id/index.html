<!DOCTYPE html>
<html lang="en" dir="ltr"><head>
  
                           
     


<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.111.3">
<title>Automated species identification with python | Camille Saade</title>








  
    
  
<meta name="description" content="Using machine learning to automate species recognition.">


<meta property="og:site_name" content="Camille Saade">
<meta property="og:title" content="Automated species identification with python | Camille Saade">
<meta property="og:description" content="Using machine learning to automate species recognition." />
<meta property="og:type" content="page" />
<meta property="og:url" content="https://c-saade.github.io/projects/species_id/" />
<meta property="og:locale" content="en">




    
        <meta property="og:image" content="https://c-saade.github.io/projects/species_id/Colpidium-featured.jpg" >
        <meta property="twitter:card" content="summary_large_image">
        <meta name="twitter:image" content="https://c-saade.github.io/projects/species_id/Colpidium-featured.jpg" >
    
    
  <meta itemprop="name" content="Automated species identification with python">
<meta itemprop="description" content="Introduction Working on ecosystem stability, my PhD led me to follow the dynamics of microcosms &ndash; artificial, simplified ecosystem made of vials and tubes and inhabited by different species of unicellular organisms. This entailed identifying and counting hundreds of thousands of individuals in more than 250 vials at regular intervals over the course of a month.
Thankfully, automation of the identification process allowed me to realize this otherwise daunting task."><meta itemprop="datePublished" content="2022-07-06T00:00:00+00:00" />
<meta itemprop="dateModified" content="2022-07-06T00:00:00+00:00" />
<meta itemprop="wordCount" content="2957"><meta itemprop="image" content="https://c-saade.github.io/projects/species_id/Colpidium-featured.jpg">
<meta itemprop="keywords" content="" />
  
  
  <!--[if IE]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/img/favicon.ico" type="image/x-icon">
  
  
  <link rel="stylesheet" href="/style.main.min.2e4a8291b96b2dcb4474650132e0e5aff4a7b7e1b7896ea2c52d9438445705e8.css" integrity="sha256-LkqCkblrLctEdGUBMuDlr/Snt&#43;G3iW6ixS2UOERXBeg=" media="screen">
  
  
  <script src="/panelset.min.ed1ac24b6e16f4e2481e3d1d098ae66f5bc77438aef619e6e266d8ac5b00dc72.js" type="text/javascript"></script>
  
  
  <script src="/main.min.4e826f267a9dde26627cbfd80419eca6153e5b3209229e861b56433f615ea2dd.js" type="text/javascript"></script>
</head>
<body>
      <div class="grid-container single">
<header class="site-header pt4 pb2 mb4 bb b--transparent ph5 headroom z-max" role="banner">
  <nav class="site-nav db dt-l w-100" role="navigation">
    <a class="site-brand db dtc-l v-mid link no-underline w-100 w-33-l tc tl-l" href="https://c-saade.github.io/" title="Home">
      <img src="/img/blogophonic-mark-dark.png" class="dib db-l h2 w-auto" alt="Camille Saade">
    </a>
    <div class="site-links db dtc-l v-mid w-100 w-47-l tc tr-l mt3 mt0-l ttu tracked">
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="/resume/" title="Resume">Resume</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 active" href="/projects/" title="Project Portfolio">Projects</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="/about/" title="About">About</a>
      
      
    </div>
  </nav>
</header>

<main class="page-main pa4" role="main">
  <section class="page-content mw7 center">
    <article class="post-content pa0 ph4-l">
      <header class="post-header">
        <h1 class="f1 lh-solid measure-narrow mb3 fw4">Automated species identification with python</h1>
        <h4 class="f4 mt0 mb4 lh-title measure">Using machine learning to automate species recognition.</h4>
        
        <p class="f7 db mv0 ttu">July 6, 2022</p>

      

      </header>
      <section class="post-body pt5 pb4">
        



<h2 id="introduction">Introduction
  <a href="#introduction"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>
<p>Working on ecosystem stability, my PhD led me to follow the 
<a href="https://doi.org/10.1098/rspb.2022.0543" target="_blank" rel="noopener">dynamics of microcosms</a> &ndash; artificial, simplified ecosystem made of vials and tubes and inhabited by different species of unicellular organisms.
This entailed identifying and counting hundreds of thousands of individuals in more than 250 vials at regular intervals over the course of a month.</p>
<p>Thankfully, automation of the identification process allowed me to realize this otherwise daunting task.
I took video samples regularly which I analyzed with the 
<a href="http://bemovi.info/" target="_blank" rel="noopener">Bemovi R-package</a> that tracks individuals (moving particles) and extracts information on them such as their size, shape and trajectory properties.
Bemovi outputs a dataframe where each row is a single individual and columns describe their properties which is well suited for classification methods.
I could thus train a machine learning algorithm on monospecific cultures (videos with only one species so we are sure about the species identity) and then use it to predict species identity in plurispecific cultures.</p>
<p>At the time, I automated species recognition in R by slapping a Random Forest algorithm with default parameters on my data, checking visually that this worked most of the time and called it a day.</p>
<p>Now that I know better, I would like to come back to this data and do better by benchmarking different ML algorithm and estimating accuracy by splitting the data into a training set and a testing set.
I will also further assess the robustness of each method by checking its accuracy on training datasets obtained at later dates, and by estimating accuracy on a dataset with added noise.
In this post, I will guide you through the automation process starting from the output of Bemovi (a dataframe describing the properties of each tracked particle) using python and Sklearn.</p>




<h2 id="data-importation-and-preparation">Data importation and preparation
  <a href="#data-importation-and-preparation"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>
<p>Let us first import a few libraries and import our training data set:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#998;font-style:italic">## libraries importation</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># data manipulation and maths</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">pandas</span> <span style="color:#000;font-weight:bold">as</span> <span style="color:#555">pd</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">numpy</span> <span style="color:#000;font-weight:bold">as</span> <span style="color:#555">np</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># plot libraries</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">matplotlib.pyplot</span> <span style="color:#000;font-weight:bold">as</span> <span style="color:#555">plt</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">seaborn</span> <span style="color:#000;font-weight:bold">as</span> <span style="color:#555">sns</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># importing data and looking at the first few rows</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">## loading data</span>
</span></span><span style="display:flex;"><span>data <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>read_csv(<span style="color:#d14">&#39;datasets/morph_data_t0.csv&#39;</span>)
</span></span><span style="display:flex;"><span>data<span style="color:#000;font-weight:bold">.</span>info()
</span></span></code></pre></div><pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 15885 entries, 0 to 15884
Data columns (total 35 columns):
 #   Column           Non-Null Count  Dtype  
---  ------           --------------  -----  
 0   file             15885 non-null  object 
 1   mean_grey        15885 non-null  float64
 2   sd_grey          15885 non-null  float64
 3   mean_area        15885 non-null  float64
 4   sd_area          15885 non-null  float64
 5   mean_perimeter   15885 non-null  float64
 6   sd_perimeter     15885 non-null  float64
 7   mean_major       15885 non-null  float64
 8   sd_major         15885 non-null  float64
 9   mean_minor       15885 non-null  float64
 10  sd_minor         15885 non-null  float64
 11  mean_ar          15885 non-null  float64
 12  sd_ar            15885 non-null  float64
 13  mean_turning     15885 non-null  float64
 14  sd_turning       15885 non-null  float64
 15  duration         15885 non-null  float64
 16  N_frames         15885 non-null  int64  
 17  max_net          15885 non-null  float64
 18  net_disp         15885 non-null  int64  
 19  net_speed        15885 non-null  float64
 20  gross_disp       15885 non-null  float64
 21  gross_speed      15885 non-null  float64
 22  max_step         15885 non-null  float64
 23  min_step         15885 non-null  float64
 24  sd_step          15885 non-null  float64
 25  sd_gross_speed   15885 non-null  float64
 26  max_gross_speed  15885 non-null  float64
 27  min_gross_speed  15885 non-null  float64
 28  id               15885 non-null  object 
 29  date             15885 non-null  object 
 30  time             15885 non-null  object 
 31  magnification    15885 non-null  int64  
 32  tube_id          15885 non-null  int64  
 33  measure_point    15885 non-null  object 
 34  community        15885 non-null  object 
dtypes: float64(25), int64(4), object(6)
memory usage: 4.2+ MB
</code></pre>
<p>This dataframe was obtained by using bemovi package, which tracks individuals from video files.
It outputs a dataframe where each line describes the properties of a tracked particle (here, a unicellular organism) such as its area, size or color.
Our target variable is contained in the &ldquo;Community&rdquo; column (but we&rsquo;ll see later that we also need to transform this variable).</p>
<p>Some of the columns are meta-data that will not be usefull for the identification:</p>
<ul>
<li>&lsquo;file&rsquo;: the name of the video file from whitch the individual was tracked.</li>
<li>&lsquo;id&rsquo;: a unique number identifying the individual.</li>
<li>&lsquo;date&rsquo;, &rsquo;time: the date and time of video recording.</li>
<li>&lsquo;magnification&rsquo;: microscope setting. Not informative since we use the same magnification for the whole experiment.</li>
<li>&rsquo;tube_id&rsquo;: a unique number identifying the falcon tube from which the sample was taken.</li>
<li>&lsquo;measure_point&rsquo;: a categorical variable describing the order of measurements.</li>
</ul>
<p>Let&rsquo;s get rid of these columns:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># dropping useless columns for id:</span>
</span></span><span style="display:flex;"><span>data<span style="color:#000;font-weight:bold">.</span>drop([<span style="color:#d14">&#39;file&#39;</span>,
</span></span><span style="display:flex;"><span>           <span style="color:#d14">&#39;id&#39;</span>,
</span></span><span style="display:flex;"><span>           <span style="color:#d14">&#39;date&#39;</span>,
</span></span><span style="display:flex;"><span>           <span style="color:#d14">&#39;time&#39;</span>,
</span></span><span style="display:flex;"><span>           <span style="color:#d14">&#39;magnification&#39;</span>,
</span></span><span style="display:flex;"><span>           <span style="color:#d14">&#39;tube_id&#39;</span>,
</span></span><span style="display:flex;"><span>           <span style="color:#d14">&#39;measure_point&#39;</span>],
</span></span><span style="display:flex;"><span>          axis <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>, inplace <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>)
</span></span></code></pre></div><p>A first thing we can do is take a look at how the variables relate to each other and to the target variable.
Because we have a lot of variables (28 columns) and observations (15885 rows), we&rsquo;ll only take a look at a few variables on a subset of the data (1000 rows).
Using a pairplot, let&rsquo;s take a look at the following variables of interest, grouped by species id:</p>
<ul>
<li>&lsquo;mean_grey&rsquo;: average grey level of an individual.</li>
<li>&lsquo;mean_area&rsquo;: average area of an individual.</li>
<li>&lsquo;mean_ar&rsquo;: mean aspect ratio (length relative to width), describes the individuals shape.</li>
<li>&lsquo;duration&rsquo;: time during which an individual was tracked. Small and fast individuals tend to get &rsquo;lost&rsquo; by the tracking algorithm and have a shorter duration.</li>
<li>&lsquo;gross_speed&rsquo;: speed of the individual</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># sampling part of the data and looking at pairplot for a few values that we think could be of interest</span>
</span></span><span style="display:flex;"><span>data_sample <span style="color:#000;font-weight:bold">=</span>  data[[<span style="color:#d14">&#39;mean_grey&#39;</span>, <span style="color:#998;font-style:italic"># particle color</span>
</span></span><span style="display:flex;"><span>                     <span style="color:#d14">&#39;mean_area&#39;</span>, <span style="color:#998;font-style:italic"># particle area</span>
</span></span><span style="display:flex;"><span>                     <span style="color:#d14">&#39;mean_ar&#39;</span>, <span style="color:#998;font-style:italic"># particle elongation (Aspect Ratio)</span>
</span></span><span style="display:flex;"><span>                     <span style="color:#d14">&#39;duration&#39;</span>,
</span></span><span style="display:flex;"><span>                     <span style="color:#d14">&#39;gross_speed&#39;</span>,
</span></span><span style="display:flex;"><span>       <span style="color:#d14">&#39;community&#39;</span>]]<span style="color:#000;font-weight:bold">.</span>sample(<span style="color:#099">1000</span>)
</span></span><span style="display:flex;"><span>sns<span style="color:#000;font-weight:bold">.</span>pairplot(data_sample, hue <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;community&#39;</span>)
</span></span></code></pre></div><pre><code>&lt;seaborn.axisgrid.PairGrid at 0x7f25cab258b0&gt;
</code></pre>
<p><img src="output_5_1.png" alt="png"></p>
<p>We can already see that the species are well separated by some variables such as their size (&lsquo;mean_area&rsquo;) and speed (&lsquo;gross_speed&rsquo;).</p>
<p>It is also worth noting that the variables are on very different scales (e.g., mean_area: 0-35000 vs. mean_grey: 100-250) so we&rsquo;ll need to rescale them. We also note quite a lot of outliers, so we&rsquo;ll want to make sure that we use a scaler that is not sensitive to outliers.</p>
<p>Lastly, we see that Blepharisma sp. are a bit underrepresented so it&rsquo;s hard to make them out. Lets look at them separately:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># sampling part of the data and looking at pairplot for a few values that we think could be of interest</span>
</span></span><span style="display:flex;"><span>data_sample_ble <span style="color:#000;font-weight:bold">=</span>  data[data<span style="color:#000;font-weight:bold">.</span>community <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#39;Ble&#39;</span>][[<span style="color:#d14">&#39;mean_grey&#39;</span>, <span style="color:#d14">&#39;mean_area&#39;</span>, <span style="color:#d14">&#39;mean_ar&#39;</span>,
</span></span><span style="display:flex;"><span>       <span style="color:#d14">&#39;duration&#39;</span>, <span style="color:#d14">&#39;gross_speed&#39;</span>,
</span></span><span style="display:flex;"><span>       <span style="color:#d14">&#39;community&#39;</span>]]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sns<span style="color:#000;font-weight:bold">.</span>pairplot(data <span style="color:#000;font-weight:bold">=</span> data_sample_ble, hue <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;community&#39;</span>)
</span></span></code></pre></div><pre><code>&lt;seaborn.axisgrid.PairGrid at 0x7f25c5a56d90&gt;
</code></pre>
<p><img src="output_7_1.png" alt="png"></p>
<p>As you can see, the color and size of Blepharisma are bimodal. Taking a look at the video, you could see that Blepharisma sp. are so big that they cast a reflection on the bottom of the microscope slide which gets picked up by the tracking algorithm. Originally, I arbitrarily took all Blepharisma sp. with a mean_grey smaller than 180 and gave them the new label &lsquo;Ble_shadow&rsquo;. Here, we&rsquo;ll try to relabel them using a clustering algorithm to be more robust (i.e., if next week we change the microscope&rsquo;s light bulb, the grey threshold might not be 180 for future videos).
We do that by running a clustering algorithm on the grey level and area of particles labelled &lsquo;Ble&rsquo;:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># importing a scaler and clustering algorithm</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">sklearn.preprocessing</span> <span style="color:#000;font-weight:bold">import</span> MinMaxScaler
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">sklearn.cluster</span> <span style="color:#000;font-weight:bold">import</span> AgglomerativeClustering
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># extracting Blepharisma&#39;s area and color</span>
</span></span><span style="display:flex;"><span>X_ble <span style="color:#000;font-weight:bold">=</span> data[data<span style="color:#000;font-weight:bold">.</span>community <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#39;Ble&#39;</span>][[<span style="color:#d14">&#39;mean_grey&#39;</span>, <span style="color:#d14">&#39;mean_area&#39;</span>]]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># scaling it</span>
</span></span><span style="display:flex;"><span>X_ble_scaled <span style="color:#000;font-weight:bold">=</span> MinMaxScaler()<span style="color:#000;font-weight:bold">.</span>fit_transform(X_ble)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># running an agglomerative clustering on it and storing the cluster id in data_sample_ble</span>
</span></span><span style="display:flex;"><span>model_ble <span style="color:#000;font-weight:bold">=</span> AgglomerativeClustering(n_clusters <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">2</span>, linkage <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;complete&#39;</span>)
</span></span><span style="display:flex;"><span>data_sample_ble[<span style="color:#d14">&#39;cluster&#39;</span>] <span style="color:#000;font-weight:bold">=</span> model_ble<span style="color:#000;font-weight:bold">.</span>fit_predict(X_ble_scaled)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Visually checking the new clusters:</span>
</span></span><span style="display:flex;"><span>sns<span style="color:#000;font-weight:bold">.</span>pairplot(data_sample_ble[[<span style="color:#d14">&#39;mean_grey&#39;</span>, <span style="color:#d14">&#39;mean_area&#39;</span>, <span style="color:#d14">&#39;cluster&#39;</span>]], hue <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;cluster&#39;</span>)
</span></span></code></pre></div><pre><code>&lt;seaborn.axisgrid.PairGrid at 0x7f25bdfbc760&gt;
</code></pre>
<p><img src="output_9_1.png" alt="png"></p>
<p>This seems to work quite well ! All that&rsquo;s left to do is to associate cluster 1 (the smallest individuals) to the label &lsquo;Ble_shadow&rsquo; and then port that to the main data into a new column that we&rsquo;ll call &lsquo;species&rsquo;:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># associating each cluster to the right label</span>
</span></span><span style="display:flex;"><span>data_sample_ble[<span style="color:#d14">&#39;species&#39;</span>] <span style="color:#000;font-weight:bold">=</span> data_sample_ble<span style="color:#000;font-weight:bold">.</span>cluster<span style="color:#000;font-weight:bold">.</span>apply(<span style="color:#000;font-weight:bold">lambda</span> x: x<span style="color:#000;font-weight:bold">*</span><span style="color:#d14">&#39;Ble_shadow&#39;</span> <span style="color:#000;font-weight:bold">+</span> (x<span style="color:#000;font-weight:bold">-</span><span style="color:#099">1</span>)<span style="color:#000;font-weight:bold">**</span><span style="color:#099">2</span> <span style="color:#000;font-weight:bold">*</span> <span style="color:#d14">&#39;Ble&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Putting that to the full data frame</span>
</span></span><span style="display:flex;"><span>data[<span style="color:#d14">&#39;species&#39;</span>] <span style="color:#000;font-weight:bold">=</span> data<span style="color:#000;font-weight:bold">.</span>community
</span></span><span style="display:flex;"><span>data<span style="color:#000;font-weight:bold">.</span>loc[data<span style="color:#000;font-weight:bold">.</span>community <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#39;Ble&#39;</span>, <span style="color:#d14">&#39;species&#39;</span>] <span style="color:#000;font-weight:bold">=</span> data_sample_ble[<span style="color:#d14">&#39;species&#39;</span>]
</span></span></code></pre></div><p>Finally, we can drop the column &lsquo;community&rsquo;, and split our data between training and testing set and we&rsquo;ll be ready to fit !</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># separating features from labels</span>
</span></span><span style="display:flex;"><span>y <span style="color:#000;font-weight:bold">=</span> data<span style="color:#000;font-weight:bold">.</span>species<span style="color:#000;font-weight:bold">.</span>values
</span></span><span style="display:flex;"><span>X <span style="color:#000;font-weight:bold">=</span> data<span style="color:#000;font-weight:bold">.</span>drop([<span style="color:#d14">&#39;community&#39;</span>, <span style="color:#d14">&#39;species&#39;</span>], axis <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>)<span style="color:#000;font-weight:bold">.</span>values
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># train-test split</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">sklearn.model_selection</span> <span style="color:#000;font-weight:bold">import</span> train_test_split
</span></span><span style="display:flex;"><span>X_train, X_test, y_train, y_test <span style="color:#000;font-weight:bold">=</span> train_test_split(X, y, test_size <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0.2</span>, random_state <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>)
</span></span></code></pre></div>



<h2 id="model-fitting">Model fitting
  <a href="#model-fitting"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>
<p>First let&rsquo;s import some libraries:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#998;font-style:italic">## Utility functions</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">sklearn.pipeline</span> <span style="color:#000;font-weight:bold">import</span> Pipeline
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#Ã¦ parmeter tuning and model validation</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">sklearn.model_selection</span> <span style="color:#000;font-weight:bold">import</span> train_test_split, GridSearchCV
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">## feature scaling</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">sklearn.preprocessing</span> <span style="color:#000;font-weight:bold">import</span> RobustScaler
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">## models</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">sklearn.ensemble</span> <span style="color:#000;font-weight:bold">import</span> RandomForestClassifier
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">sklearn.neighbors</span> <span style="color:#000;font-weight:bold">import</span> KNeighborsClassifier
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">sklearn.neural_network</span> <span style="color:#000;font-weight:bold">import</span> MLPClassifier
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">sklearn.svm</span> <span style="color:#000;font-weight:bold">import</span> LinearSVC
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">sklearn.linear_model</span> <span style="color:#000;font-weight:bold">import</span> RidgeClassifier
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># to time the fit of each function</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">time</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">datetime</span> <span style="color:#000;font-weight:bold">import</span> timedelta
</span></span></code></pre></div><p>Now we declare a list of models and parameter grids to explore for each:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>names <span style="color:#000;font-weight:bold">=</span> [<span style="color:#d14">&#39;knn&#39;</span>, <span style="color:#d14">&#39;random_forest&#39;</span>,
</span></span><span style="display:flex;"><span>         <span style="color:#d14">&#39;neuralnet&#39;</span>, <span style="color:#d14">&#39;SVC&#39;</span>, <span style="color:#d14">&#39;ridge&#39;</span>]
</span></span><span style="display:flex;"><span>classifiers <span style="color:#000;font-weight:bold">=</span> [KNeighborsClassifier(), RandomForestClassifier(),
</span></span><span style="display:flex;"><span>               MLPClassifier(max_iter <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">500</span>), LinearSVC(), RidgeClassifier()]
</span></span><span style="display:flex;"><span>params <span style="color:#000;font-weight:bold">=</span> [{<span style="color:#d14">&#39;knn__n_neighbors&#39;</span>: <span style="color:#0086b3">range</span>(<span style="color:#099">1</span>, <span style="color:#099">10</span>)},
</span></span><span style="display:flex;"><span>          {<span style="color:#d14">&#39;random_forest__n_estimators&#39;</span>: [<span style="color:#099">50</span>, <span style="color:#099">100</span>, <span style="color:#099">200</span>]},
</span></span><span style="display:flex;"><span>          {<span style="color:#d14">&#39;neuralnet__hidden_layer_sizes&#39;</span>: [(<span style="color:#099">80</span>), (<span style="color:#099">40</span>, <span style="color:#099">10</span>), (<span style="color:#099">30</span>, <span style="color:#099">10</span>, <span style="color:#099">5</span>)]},
</span></span><span style="display:flex;"><span>          {<span style="color:#d14">&#39;SVC__C&#39;</span>: [<span style="color:#099">0.5</span>, <span style="color:#099">1.0</span>, <span style="color:#099">2.0</span>]},
</span></span><span style="display:flex;"><span>          {<span style="color:#d14">&#39;ridge__alpha&#39;</span>: [<span style="color:#099">0.5</span>, <span style="color:#099">1.0</span>, <span style="color:#099">2.0</span>, <span style="color:#099">5.0</span>, <span style="color:#099">10.0</span>]}
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><p>Lastly, we fit each model to the training data and extract the accuracy score on the test data:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>model_cv <span style="color:#000;font-weight:bold">=</span> []
</span></span><span style="display:flex;"><span>scores_list <span style="color:#000;font-weight:bold">=</span> []
</span></span><span style="display:flex;"><span>times <span style="color:#000;font-weight:bold">=</span> []
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">for</span> k <span style="color:#000;font-weight:bold">in</span> <span style="color:#0086b3">range</span>(<span style="color:#0086b3">len</span>(names)):
</span></span><span style="display:flex;"><span>    model_cv<span style="color:#000;font-weight:bold">.</span>append(GridSearchCV(Pipeline([(<span style="color:#d14">&#39;scaler&#39;</span>, RobustScaler()), (names[k], classifiers[k])]),
</span></span><span style="display:flex;"><span>                               params[k], cv <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">5</span>))
</span></span><span style="display:flex;"><span>    start_time <span style="color:#000;font-weight:bold">=</span> time<span style="color:#000;font-weight:bold">.</span>monotonic()
</span></span><span style="display:flex;"><span>    model_cv[k]<span style="color:#000;font-weight:bold">.</span>fit(X_train, y_train)
</span></span><span style="display:flex;"><span>    end_time <span style="color:#000;font-weight:bold">=</span> time<span style="color:#000;font-weight:bold">.</span>monotonic()
</span></span><span style="display:flex;"><span>    scores_list<span style="color:#000;font-weight:bold">.</span>append(model_cv[k]<span style="color:#000;font-weight:bold">.</span>score(X_test, y_test))
</span></span><span style="display:flex;"><span>    times<span style="color:#000;font-weight:bold">.</span>append(timedelta(seconds<span style="color:#000;font-weight:bold">=</span>end_time <span style="color:#000;font-weight:bold">-</span> start_time))
</span></span></code></pre></div><pre><code>/usr/local/lib/python3.8/dist-packages/sklearn/svm/_base.py:1206: ConvergenceWarning: Liblinear failed to converge, increase the number of iterations.
  warnings.warn(
/usr/local/lib/python3.8/dist-packages/sklearn/svm/_base.py:1206: ConvergenceWarning: Liblinear failed to converge, increase the number of iterations.
  warnings.warn(
/usr/local/lib/python3.8/dist-packages/sklearn/svm/_base.py:1206: ConvergenceWarning: Liblinear failed to converge, increase the number of iterations.
  warnings.warn(
/usr/local/lib/python3.8/dist-packages/sklearn/svm/_base.py:1206: ConvergenceWarning: Liblinear failed to converge, increase the number of iterations.
  warnings.warn(
/usr/local/lib/python3.8/dist-packages/sklearn/svm/_base.py:1206: ConvergenceWarning: Liblinear failed to converge, increase the number of iterations.
  warnings.warn(
/usr/local/lib/python3.8/dist-packages/sklearn/svm/_base.py:1206: ConvergenceWarning: Liblinear failed to converge, increase the number of iterations.
  warnings.warn(
/usr/local/lib/python3.8/dist-packages/sklearn/svm/_base.py:1206: ConvergenceWarning: Liblinear failed to converge, increase the number of iterations.
  warnings.warn(
/usr/local/lib/python3.8/dist-packages/sklearn/svm/_base.py:1206: ConvergenceWarning: Liblinear failed to converge, increase the number of iterations.
  warnings.warn(
/usr/local/lib/python3.8/dist-packages/sklearn/svm/_base.py:1206: ConvergenceWarning: Liblinear failed to converge, increase the number of iterations.
  warnings.warn(
/usr/local/lib/python3.8/dist-packages/sklearn/svm/_base.py:1206: ConvergenceWarning: Liblinear failed to converge, increase the number of iterations.
  warnings.warn(
/usr/local/lib/python3.8/dist-packages/sklearn/svm/_base.py:1206: ConvergenceWarning: Liblinear failed to converge, increase the number of iterations.
  warnings.warn(
/usr/local/lib/python3.8/dist-packages/sklearn/svm/_base.py:1206: ConvergenceWarning: Liblinear failed to converge, increase the number of iterations.
  warnings.warn(
/usr/local/lib/python3.8/dist-packages/sklearn/svm/_base.py:1206: ConvergenceWarning: Liblinear failed to converge, increase the number of iterations.
  warnings.warn(
/usr/local/lib/python3.8/dist-packages/sklearn/svm/_base.py:1206: ConvergenceWarning: Liblinear failed to converge, increase the number of iterations.
  warnings.warn(
/usr/local/lib/python3.8/dist-packages/sklearn/svm/_base.py:1206: ConvergenceWarning: Liblinear failed to converge, increase the number of iterations.
  warnings.warn(
/usr/local/lib/python3.8/dist-packages/sklearn/svm/_base.py:1206: ConvergenceWarning: Liblinear failed to converge, increase the number of iterations.
  warnings.warn(
</code></pre>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>scores <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>DataFrame({<span style="color:#d14">&#39;model&#39;</span>: names, <span style="color:#d14">&#39;test_score&#39;</span> : scores_list, <span style="color:#d14">&#39;train_score&#39;</span> : [m<span style="color:#000;font-weight:bold">.</span>best_score_ <span style="color:#000;font-weight:bold">for</span> m <span style="color:#000;font-weight:bold">in</span> model_cv], <span style="color:#d14">&#39;time&#39;</span> : [t<span style="color:#000;font-weight:bold">.</span>seconds <span style="color:#000;font-weight:bold">for</span> t <span style="color:#000;font-weight:bold">in</span> times]})
</span></span><span style="display:flex;"><span>scores<span style="color:#000;font-weight:bold">.</span>sort_values(<span style="color:#d14">&#39;test_score&#39;</span>, inplace <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>, ascending <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>)
</span></span></code></pre></div><p>Comparing the accuracy of different models, testing on the left and training on the right:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>fig, ax <span style="color:#000;font-weight:bold">=</span> plt<span style="color:#000;font-weight:bold">.</span>subplots(figsize<span style="color:#000;font-weight:bold">=</span>(<span style="color:#099">8</span>, <span style="color:#099">5</span>), ncols<span style="color:#000;font-weight:bold">=</span><span style="color:#099">2</span>, sharey<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#fig.tight_layout()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sns<span style="color:#000;font-weight:bold">.</span>barplot(ax <span style="color:#000;font-weight:bold">=</span> ax[<span style="color:#099">0</span>], x<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;test_score&#34;</span>, y<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;model&#34;</span>, data<span style="color:#000;font-weight:bold">=</span>scores, hue <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;test_score&#39;</span>, dodge<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">False</span>, palette <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;flare&#39;</span>)
</span></span><span style="display:flex;"><span>ax[<span style="color:#099">0</span>]<span style="color:#000;font-weight:bold">.</span>legend_<span style="color:#000;font-weight:bold">.</span>remove()
</span></span><span style="display:flex;"><span>ax[<span style="color:#099">0</span>]<span style="color:#000;font-weight:bold">.</span>set_xlim(<span style="color:#099">0.98</span>, <span style="color:#099">1</span>)
</span></span><span style="display:flex;"><span>ax[<span style="color:#099">0</span>]<span style="color:#000;font-weight:bold">.</span>set_title(<span style="color:#d14">&#39;Testing accuracy&#39;</span>)
</span></span><span style="display:flex;"><span>ax[<span style="color:#099">0</span>]<span style="color:#000;font-weight:bold">.</span>invert_xaxis()
</span></span><span style="display:flex;"><span>ax[<span style="color:#099">0</span>]<span style="color:#000;font-weight:bold">.</span>set(ylabel <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;Model&#39;</span>, xlabel <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sns<span style="color:#000;font-weight:bold">.</span>barplot(ax<span style="color:#000;font-weight:bold">=</span>ax[<span style="color:#099">1</span>], x<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;train_score&#34;</span>, y<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;model&#34;</span>, data<span style="color:#000;font-weight:bold">=</span>scores, hue <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;train_score&#39;</span>, dodge<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">False</span>, palette <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;crest&#39;</span>)
</span></span><span style="display:flex;"><span>ax[<span style="color:#099">1</span>]<span style="color:#000;font-weight:bold">.</span>legend_<span style="color:#000;font-weight:bold">.</span>remove()
</span></span><span style="display:flex;"><span>ax[<span style="color:#099">1</span>]<span style="color:#000;font-weight:bold">.</span>set_xlim(<span style="color:#099">0.98</span>, <span style="color:#099">1</span>)
</span></span><span style="display:flex;"><span>ax[<span style="color:#099">1</span>]<span style="color:#000;font-weight:bold">.</span>set_title(<span style="color:#d14">&#39;Training accuracy&#39;</span>)
</span></span><span style="display:flex;"><span>ax[<span style="color:#099">1</span>]<span style="color:#000;font-weight:bold">.</span>set(ylabel <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;&#39;</span>, xlabel <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>ax[<span style="color:#099">1</span>]<span style="color:#000;font-weight:bold">.</span>yaxis<span style="color:#000;font-weight:bold">.</span>tick_right()
</span></span><span style="display:flex;"><span>ax[<span style="color:#099">1</span>]<span style="color:#000;font-weight:bold">.</span>set_xticks(ax[<span style="color:#099">1</span>]<span style="color:#000;font-weight:bold">.</span>get_xticks()[<span style="color:#099">1</span>:])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>plt<span style="color:#000;font-weight:bold">.</span>subplots_adjust(wspace<span style="color:#000;font-weight:bold">=</span><span style="color:#099">0</span>)
</span></span></code></pre></div><p><img src="output_22_0.png" alt="png"></p>
<p>Checking the runtime of each model (right):</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>fig, ax <span style="color:#000;font-weight:bold">=</span> plt<span style="color:#000;font-weight:bold">.</span>subplots(figsize<span style="color:#000;font-weight:bold">=</span>(<span style="color:#099">8</span>, <span style="color:#099">5</span>), ncols<span style="color:#000;font-weight:bold">=</span><span style="color:#099">2</span>, sharey<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#fig.tight_layout()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sns<span style="color:#000;font-weight:bold">.</span>barplot(ax <span style="color:#000;font-weight:bold">=</span> ax[<span style="color:#099">0</span>], x<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;test_score&#34;</span>, y<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;model&#34;</span>, data<span style="color:#000;font-weight:bold">=</span>scores, hue <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;test_score&#39;</span>, dodge<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">False</span>, palette <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;flare&#39;</span>)
</span></span><span style="display:flex;"><span>ax[<span style="color:#099">0</span>]<span style="color:#000;font-weight:bold">.</span>legend_<span style="color:#000;font-weight:bold">.</span>remove()
</span></span><span style="display:flex;"><span>ax[<span style="color:#099">0</span>]<span style="color:#000;font-weight:bold">.</span>set_xlim(<span style="color:#099">0.98</span>, <span style="color:#099">1</span>)
</span></span><span style="display:flex;"><span>ax[<span style="color:#099">0</span>]<span style="color:#000;font-weight:bold">.</span>set_title(<span style="color:#d14">&#39;Testing accuracy&#39;</span>)
</span></span><span style="display:flex;"><span>ax[<span style="color:#099">0</span>]<span style="color:#000;font-weight:bold">.</span>invert_xaxis()
</span></span><span style="display:flex;"><span>ax[<span style="color:#099">0</span>]<span style="color:#000;font-weight:bold">.</span>set(ylabel <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;Model&#39;</span>, xlabel <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>ax[<span style="color:#099">0</span>]<span style="color:#000;font-weight:bold">.</span>set_xticks(ax[<span style="color:#099">0</span>]<span style="color:#000;font-weight:bold">.</span>get_xticks()[<span style="color:#099">1</span>:])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sns<span style="color:#000;font-weight:bold">.</span>barplot(ax<span style="color:#000;font-weight:bold">=</span>ax[<span style="color:#099">1</span>], x<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;time&#34;</span>, y<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;model&#34;</span>, data<span style="color:#000;font-weight:bold">=</span>scores, hue <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;time&#39;</span>, dodge<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">False</span>, palette <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;crest&#39;</span>)
</span></span><span style="display:flex;"><span>ax[<span style="color:#099">1</span>]<span style="color:#000;font-weight:bold">.</span>legend_<span style="color:#000;font-weight:bold">.</span>remove()
</span></span><span style="display:flex;"><span>ax[<span style="color:#099">1</span>]<span style="color:#000;font-weight:bold">.</span>set_title(<span style="color:#d14">&#39;Fitting time&#39;</span>)
</span></span><span style="display:flex;"><span>ax[<span style="color:#099">1</span>]<span style="color:#000;font-weight:bold">.</span>set(ylabel <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;&#39;</span>, xlabel <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>ax[<span style="color:#099">1</span>]<span style="color:#000;font-weight:bold">.</span>yaxis<span style="color:#000;font-weight:bold">.</span>tick_right()
</span></span><span style="display:flex;"><span>ax[<span style="color:#099">1</span>]<span style="color:#000;font-weight:bold">.</span>set_xticks(ax[<span style="color:#099">1</span>]<span style="color:#000;font-weight:bold">.</span>get_xticks()[<span style="color:#099">1</span>:])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>plt<span style="color:#000;font-weight:bold">.</span>subplots_adjust(wspace<span style="color:#000;font-weight:bold">=</span><span style="color:#099">0</span>)
</span></span></code></pre></div><p><img src="output_24_0.png" alt="png"></p>
<p>All models are quite good with more than 99% accuracy on the test set. SVC is very efficient given its fast training time but I&rsquo;m a bit worried by the convergence warnings. Also consider that models with few parameters (SVC, knn and ridge) are probably close to their best performance already but neural net and random forest could probably be improved through hyperparameter fine tuning.</p>
<p>If 1% error is not an issue for you, I would recommend using knn or ridge as they are already very accurate but are also super easy and fast to tune.
If having a very high accuracy matters, I would recommend using a neuralnet and taking some more time to fine tune the parameters.</p>
<p>However, I&rsquo;d like to make 2 final tests to check that our models are efficient on tricky data to make sure that they generalize well and get an idea of the worst performance we can expect.</p>




<h2 id="model-assessment-on-tricky-data">Model assessment on tricky data
  <a href="#model-assessment-on-tricky-data"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>
<p>To check the robustness of the different models by using tricky test data, namely:</p>
<ul>
<li>on data taken another day, as unicellular organisms are fairly plastic and their traits can vary over time.</li>
<li>on noisy data, by applying some white noise to the individual&rsquo;s traits.</li>
</ul>




<h3 id="data-importation-automation">Data importation automation
  <a href="#data-importation-automation"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>In order to test the models on more data, I need to declare a function that automates data processing (dropping useless columns, classifying Ble/Ble_Shadow).</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">clean_data</span>(data):
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic"># dropping useless columns for id:</span>
</span></span><span style="display:flex;"><span>    data<span style="color:#000;font-weight:bold">.</span>drop([<span style="color:#d14">&#39;file&#39;</span>, <span style="color:#998;font-style:italic"># name of the video file where the particle comes from</span>
</span></span><span style="display:flex;"><span>           <span style="color:#d14">&#39;id&#39;</span>,   <span style="color:#998;font-style:italic"># id of the particle</span>
</span></span><span style="display:flex;"><span>           <span style="color:#d14">&#39;date&#39;</span>, <span style="color:#998;font-style:italic"># date of the video</span>
</span></span><span style="display:flex;"><span>           <span style="color:#d14">&#39;time&#39;</span>, <span style="color:#998;font-style:italic"># hour of the video</span>
</span></span><span style="display:flex;"><span>           <span style="color:#d14">&#39;magnification&#39;</span>, <span style="color:#998;font-style:italic"># microscope setting</span>
</span></span><span style="display:flex;"><span>           <span style="color:#d14">&#39;tube_id&#39;</span>, <span style="color:#998;font-style:italic"># id of the tube the sample comes from</span>
</span></span><span style="display:flex;"><span>           <span style="color:#d14">&#39;measure_point&#39;</span>], <span style="color:#998;font-style:italic"># a categorical variable that describe which measurement it was in the experiment.</span>
</span></span><span style="display:flex;"><span>          axis <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>, inplace <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">## identifying Ble_shadows</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic"># extracting Blepharisma&#39;s area and color</span>
</span></span><span style="display:flex;"><span>    X_ble <span style="color:#000;font-weight:bold">=</span> data[data<span style="color:#000;font-weight:bold">.</span>community <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#39;Ble&#39;</span>][[<span style="color:#d14">&#39;mean_grey&#39;</span>, <span style="color:#d14">&#39;mean_area&#39;</span>]]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic"># scaling it</span>
</span></span><span style="display:flex;"><span>    X_ble_scaled <span style="color:#000;font-weight:bold">=</span> MinMaxScaler()<span style="color:#000;font-weight:bold">.</span>fit_transform(X_ble)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic"># running an agglomerative clustering on it and storing the cluster id in data_sample_ble</span>
</span></span><span style="display:flex;"><span>    model_ble <span style="color:#000;font-weight:bold">=</span> AgglomerativeClustering(n_clusters <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">2</span>, linkage <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;complete&#39;</span>)
</span></span><span style="display:flex;"><span>    cluster <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>Series(model_ble<span style="color:#000;font-weight:bold">.</span>fit_predict(X_ble_scaled))
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic"># associating each cluster to the right label</span>
</span></span><span style="display:flex;"><span>    species <span style="color:#000;font-weight:bold">=</span> cluster<span style="color:#000;font-weight:bold">.</span>apply(<span style="color:#000;font-weight:bold">lambda</span> x: x<span style="color:#000;font-weight:bold">*</span><span style="color:#d14">&#39;Ble_shadow&#39;</span> <span style="color:#000;font-weight:bold">+</span> (x<span style="color:#000;font-weight:bold">-</span><span style="color:#099">1</span>)<span style="color:#000;font-weight:bold">**</span><span style="color:#099">2</span> <span style="color:#000;font-weight:bold">*</span> <span style="color:#d14">&#39;Ble&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic"># Putting that to the full data frame</span>
</span></span><span style="display:flex;"><span>    data[<span style="color:#d14">&#39;species&#39;</span>] <span style="color:#000;font-weight:bold">=</span> data<span style="color:#000;font-weight:bold">.</span>community
</span></span><span style="display:flex;"><span>    data<span style="color:#000;font-weight:bold">.</span>loc[data<span style="color:#000;font-weight:bold">.</span>community <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#39;Ble&#39;</span>, <span style="color:#d14">&#39;species&#39;</span>] <span style="color:#000;font-weight:bold">=</span> species
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">None</span>
</span></span></code></pre></div>



<h3 id="fitting-the-models-to-all-data-points">fitting the models to all data points
  <a href="#fitting-the-models-to-all-data-points"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>The data I used to fit the model was taken on the first day of the experiment (&lsquo;datasets/morph_data_t0.csv&rsquo;), but we also have 11 more data sets (t1 to t11) taken in the following days.
I will now test the models on this data to assess their robustness:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Creating a dataframe that will store the accuracy of each model on each data set</span>
</span></span><span style="display:flex;"><span>temp_df <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>DataFrame({<span style="color:#d14">&#39;model&#39;</span>:names})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">## looping over all times</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">for</span> time <span style="color:#000;font-weight:bold">in</span> <span style="color:#0086b3">range</span>(<span style="color:#099">1</span>, <span style="color:#099">12</span>):
</span></span><span style="display:flex;"><span>    file <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;datasets/morph_data_t&#39;</span> <span style="color:#000;font-weight:bold">+</span> <span style="color:#0086b3">str</span>(time) <span style="color:#000;font-weight:bold">+</span> <span style="color:#d14">&#39;.csv&#39;</span>
</span></span><span style="display:flex;"><span>    temp_data <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>read_csv(file)
</span></span><span style="display:flex;"><span>    clean_data(temp_data)
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic"># separating features from labels</span>
</span></span><span style="display:flex;"><span>    y_temp <span style="color:#000;font-weight:bold">=</span> temp_data<span style="color:#000;font-weight:bold">.</span>species<span style="color:#000;font-weight:bold">.</span>values
</span></span><span style="display:flex;"><span>    X_temp <span style="color:#000;font-weight:bold">=</span> temp_data<span style="color:#000;font-weight:bold">.</span>drop([<span style="color:#d14">&#39;community&#39;</span>, <span style="color:#d14">&#39;species&#39;</span>], axis <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>)<span style="color:#000;font-weight:bold">.</span>values
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">## Creating a list of scores for this time step</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    t_score <span style="color:#000;font-weight:bold">=</span> []
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">## fitting each model at given time</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">for</span> model_id <span style="color:#000;font-weight:bold">in</span> <span style="color:#0086b3">range</span>(<span style="color:#0086b3">len</span>(names)):
</span></span><span style="display:flex;"><span>        t_score<span style="color:#000;font-weight:bold">.</span>append(model_cv[model_id]<span style="color:#000;font-weight:bold">.</span>score(X_temp, y_temp))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    temp_df[<span style="color:#d14">&#39;t_&#39;</span> <span style="color:#000;font-weight:bold">+</span> <span style="color:#0086b3">str</span>(time)] <span style="color:#000;font-weight:bold">=</span> t_score
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>temp_df
</span></span></code></pre></div><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>model</th>
      <th>t_1</th>
      <th>t_2</th>
      <th>t_3</th>
      <th>t_4</th>
      <th>t_5</th>
      <th>t_6</th>
      <th>t_7</th>
      <th>t_8</th>
      <th>t_9</th>
      <th>t_10</th>
      <th>t_11</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>knn</td>
      <td>0.987349</td>
      <td>0.984904</td>
      <td>0.985214</td>
      <td>0.946599</td>
      <td>0.957288</td>
      <td>0.987789</td>
      <td>0.976901</td>
      <td>0.965896</td>
      <td>0.974500</td>
      <td>0.936820</td>
      <td>0.970832</td>
    </tr>
    <tr>
      <th>1</th>
      <td>random_forest</td>
      <td>0.990536</td>
      <td>0.991766</td>
      <td>0.991418</td>
      <td>0.955245</td>
      <td>0.962504</td>
      <td>0.989417</td>
      <td>0.986051</td>
      <td>0.985130</td>
      <td>0.984590</td>
      <td>0.948536</td>
      <td>0.978935</td>
    </tr>
    <tr>
      <th>2</th>
      <td>neuralnet</td>
      <td>0.992854</td>
      <td>0.993666</td>
      <td>0.994520</td>
      <td>0.955372</td>
      <td>0.963913</td>
      <td>0.991859</td>
      <td>0.986351</td>
      <td>0.974947</td>
      <td>0.986975</td>
      <td>0.950209</td>
      <td>0.981568</td>
    </tr>
    <tr>
      <th>3</th>
      <td>SVC</td>
      <td>0.991695</td>
      <td>0.989760</td>
      <td>0.993072</td>
      <td>0.952956</td>
      <td>0.964336</td>
      <td>0.991534</td>
      <td>0.980501</td>
      <td>0.965896</td>
      <td>0.984223</td>
      <td>0.948117</td>
      <td>0.978935</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ridge</td>
      <td>0.988218</td>
      <td>0.984904</td>
      <td>0.988109</td>
      <td>0.953592</td>
      <td>0.959825</td>
      <td>0.981276</td>
      <td>0.973751</td>
      <td>0.977534</td>
      <td>0.984407</td>
      <td>0.950209</td>
      <td>0.975289</td>
    </tr>
  </tbody>
</table>
</div>
<p>We can now aggregate this dataframe to get the average accuracy over all data points:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>temp_df_long <span style="color:#000;font-weight:bold">=</span> temp_df<span style="color:#000;font-weight:bold">.</span>melt(id_vars<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;model&#39;</span>, value_vars<span style="color:#000;font-weight:bold">=</span>[<span style="color:#d14">&#39;t_&#39;</span> <span style="color:#000;font-weight:bold">+</span> <span style="color:#0086b3">str</span>(k) <span style="color:#000;font-weight:bold">for</span> k <span style="color:#000;font-weight:bold">in</span> <span style="color:#0086b3">range</span>(<span style="color:#099">1</span>,<span style="color:#099">12</span>)], var_name <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;Measurement&#39;</span>, value_name <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;Accuracy&#39;</span>)
</span></span><span style="display:flex;"><span>mean_sd_scores <span style="color:#000;font-weight:bold">=</span> temp_df_long<span style="color:#000;font-weight:bold">.</span>groupby(<span style="color:#d14">&#39;model&#39;</span>)<span style="color:#000;font-weight:bold">.</span>agg(Accuracy_mean <span style="color:#000;font-weight:bold">=</span> (<span style="color:#d14">&#39;Accuracy&#39;</span>, <span style="color:#d14">&#39;mean&#39;</span>), Accuracy_std <span style="color:#000;font-weight:bold">=</span> (<span style="color:#d14">&#39;Accuracy&#39;</span>, <span style="color:#d14">&#39;std&#39;</span>))
</span></span><span style="display:flex;"><span>mean_sd_scores<span style="color:#000;font-weight:bold">.</span>reset_index(inplace <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>scores <span style="color:#000;font-weight:bold">=</span> scores<span style="color:#000;font-weight:bold">.</span>merge(mean_sd_scores, on <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;model&#39;</span>)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>scores
</span></span></code></pre></div><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>model</th>
      <th>test_score</th>
      <th>train_score</th>
      <th>time</th>
      <th>Accuracy_mean</th>
      <th>Accuracy_std</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>neuralnet</td>
      <td>0.996852</td>
      <td>0.997718</td>
      <td>78</td>
      <td>0.979294</td>
      <td>0.016024</td>
    </tr>
    <tr>
      <th>1</th>
      <td>SVC</td>
      <td>0.996223</td>
      <td>0.997718</td>
      <td>4</td>
      <td>0.976457</td>
      <td>0.016153</td>
    </tr>
    <tr>
      <th>2</th>
      <td>knn</td>
      <td>0.994649</td>
      <td>0.994098</td>
      <td>40</td>
      <td>0.970372</td>
      <td>0.017219</td>
    </tr>
    <tr>
      <th>3</th>
      <td>random_forest</td>
      <td>0.994649</td>
      <td>0.996695</td>
      <td>63</td>
      <td>0.978557</td>
      <td>0.015619</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ridge</td>
      <td>0.992446</td>
      <td>0.992996</td>
      <td>3</td>
      <td>0.974283</td>
      <td>0.013704</td>
    </tr>
  </tbody>
</table>
</div>
<p>Let us plot the average accuracy of the different models:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>fig, ax <span style="color:#000;font-weight:bold">=</span> plt<span style="color:#000;font-weight:bold">.</span>subplots(figsize<span style="color:#000;font-weight:bold">=</span>(<span style="color:#099">8</span>, <span style="color:#099">5</span>), ncols<span style="color:#000;font-weight:bold">=</span><span style="color:#099">2</span>, sharey<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#fig.tight_layout()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sns<span style="color:#000;font-weight:bold">.</span>barplot(ax <span style="color:#000;font-weight:bold">=</span> ax[<span style="color:#099">0</span>], x<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;test_score&#34;</span>, y<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;model&#34;</span>, data<span style="color:#000;font-weight:bold">=</span>scores, hue <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;test_score&#39;</span>, dodge<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">False</span>, palette <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;flare&#39;</span>)
</span></span><span style="display:flex;"><span>ax[<span style="color:#099">0</span>]<span style="color:#000;font-weight:bold">.</span>legend_<span style="color:#000;font-weight:bold">.</span>remove()
</span></span><span style="display:flex;"><span>ax[<span style="color:#099">0</span>]<span style="color:#000;font-weight:bold">.</span>set_xlim(<span style="color:#099">0.95</span>, <span style="color:#099">1</span>)
</span></span><span style="display:flex;"><span>ax[<span style="color:#099">0</span>]<span style="color:#000;font-weight:bold">.</span>set_title(<span style="color:#d14">&#39;Testing accuracy&#39;</span>)
</span></span><span style="display:flex;"><span>ax[<span style="color:#099">0</span>]<span style="color:#000;font-weight:bold">.</span>invert_xaxis()
</span></span><span style="display:flex;"><span>ax[<span style="color:#099">0</span>]<span style="color:#000;font-weight:bold">.</span>set(ylabel <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;Model&#39;</span>, xlabel <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sns<span style="color:#000;font-weight:bold">.</span>barplot(ax<span style="color:#000;font-weight:bold">=</span>ax[<span style="color:#099">1</span>], x<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;Accuracy_mean&#34;</span>, y<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;model&#34;</span>, data<span style="color:#000;font-weight:bold">=</span>scores, hue <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;Accuracy_mean&#39;</span>, dodge<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">False</span>, palette <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;crest&#39;</span>)
</span></span><span style="display:flex;"><span>ax[<span style="color:#099">1</span>]<span style="color:#000;font-weight:bold">.</span>legend_<span style="color:#000;font-weight:bold">.</span>remove()
</span></span><span style="display:flex;"><span>ax[<span style="color:#099">1</span>]<span style="color:#000;font-weight:bold">.</span>set_xlim(<span style="color:#099">0.95</span>, <span style="color:#099">1</span>)
</span></span><span style="display:flex;"><span>ax[<span style="color:#099">1</span>]<span style="color:#000;font-weight:bold">.</span>set_title(<span style="color:#d14">&#39;Testing accuracy for t &gt; 1&#39;</span>)
</span></span><span style="display:flex;"><span>ax[<span style="color:#099">1</span>]<span style="color:#000;font-weight:bold">.</span>set(ylabel <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;&#39;</span>, xlabel <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>ax[<span style="color:#099">1</span>]<span style="color:#000;font-weight:bold">.</span>yaxis<span style="color:#000;font-weight:bold">.</span>tick_right()
</span></span><span style="display:flex;"><span>ax[<span style="color:#099">1</span>]<span style="color:#000;font-weight:bold">.</span>set_xticks(ax[<span style="color:#099">1</span>]<span style="color:#000;font-weight:bold">.</span>get_xticks()[<span style="color:#099">1</span>:])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>plt<span style="color:#000;font-weight:bold">.</span>subplots_adjust(wspace<span style="color:#000;font-weight:bold">=</span><span style="color:#099">0</span>)
</span></span></code></pre></div><p><img src="output_36_0.png" alt="png"></p>




<h3 id="fitting-the-models-to-noisy-data">fitting the models to noisy data
  <a href="#fitting-the-models-to-noisy-data"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>Lastly, I want to artificially create tricky data by applying some white noise to the data.
I first define a function that returns noisy data from clean data, and then test the models over different noise amplitudes (sd).</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># defining a function that adds noise to data</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">add_noise</span>(X, sd):
</span></span><span style="display:flex;"><span>    noise_array <span style="color:#000;font-weight:bold">=</span> np<span style="color:#000;font-weight:bold">.</span>random<span style="color:#000;font-weight:bold">.</span>normal(<span style="color:#099">1</span>, sd, X<span style="color:#000;font-weight:bold">.</span>shape)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span>(X<span style="color:#000;font-weight:bold">*</span>noise_array)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># defining the range of noise amplitude we want to explore</span>
</span></span><span style="display:flex;"><span>sd_space <span style="color:#000;font-weight:bold">=</span> np<span style="color:#000;font-weight:bold">.</span>linspace(<span style="color:#099">0</span>, <span style="color:#099">0.3</span>, <span style="color:#099">6</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># creating some lists to store the model names, noise amplitude, and accuracy</span>
</span></span><span style="display:flex;"><span>temp_models <span style="color:#000;font-weight:bold">=</span> []
</span></span><span style="display:flex;"><span>sd_list <span style="color:#000;font-weight:bold">=</span> []
</span></span><span style="display:flex;"><span>accuracy <span style="color:#000;font-weight:bold">=</span> []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># looping over several replicates and noise amplitudes</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">for</span> replicate <span style="color:#000;font-weight:bold">in</span> <span style="color:#0086b3">range</span>(<span style="color:#099">20</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">for</span> sd <span style="color:#000;font-weight:bold">in</span> sd_space:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        X_train_noisy <span style="color:#000;font-weight:bold">=</span> add_noise(X_train, sd)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        X_test_noisy <span style="color:#000;font-weight:bold">=</span> add_noise(X_test, sd)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">## fitting each model at given time</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">for</span> model_id <span style="color:#000;font-weight:bold">in</span> <span style="color:#0086b3">range</span>(<span style="color:#0086b3">len</span>(names)):
</span></span><span style="display:flex;"><span>            model <span style="color:#000;font-weight:bold">=</span> model_cv[model_id]<span style="color:#000;font-weight:bold">.</span>best_estimator_
</span></span><span style="display:flex;"><span>            model<span style="color:#000;font-weight:bold">.</span>fit(X_train_noisy, y_train)
</span></span><span style="display:flex;"><span>            accuracy<span style="color:#000;font-weight:bold">.</span>append(model<span style="color:#000;font-weight:bold">.</span>score(X_test_noisy, y_test))
</span></span><span style="display:flex;"><span>            temp_models<span style="color:#000;font-weight:bold">.</span>append(names[model_id])
</span></span><span style="display:flex;"><span>            sd_list<span style="color:#000;font-weight:bold">.</span>append(sd)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>noise_df_long <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>DataFrame({<span style="color:#d14">&#39;model&#39;</span>: temp_models, <span style="color:#d14">&#39;Sd&#39;</span>: sd_list, <span style="color:#d14">&#39;Accuracy&#39;</span>: accuracy})
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>noise_df_long<span style="color:#000;font-weight:bold">.</span>head()
</span></span></code></pre></div><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>model</th>
      <th>Sd</th>
      <th>Accuracy</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>knn</td>
      <td>0.0</td>
      <td>0.994649</td>
    </tr>
    <tr>
      <th>1</th>
      <td>random_forest</td>
      <td>0.0</td>
      <td>0.995279</td>
    </tr>
    <tr>
      <th>2</th>
      <td>neuralnet</td>
      <td>0.0</td>
      <td>0.996223</td>
    </tr>
    <tr>
      <th>3</th>
      <td>SVC</td>
      <td>0.0</td>
      <td>0.996223</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ridge</td>
      <td>0.0</td>
      <td>0.992446</td>
    </tr>
  </tbody>
</table>
</div>
<p>Finally, we can plot the accuracy of the different models against the noise amplitude:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>fig, ax <span style="color:#000;font-weight:bold">=</span> plt<span style="color:#000;font-weight:bold">.</span>subplots(figsize<span style="color:#000;font-weight:bold">=</span>(<span style="color:#099">12</span>, <span style="color:#099">8</span>), sharey<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>sns<span style="color:#000;font-weight:bold">.</span>lineplot(ax <span style="color:#000;font-weight:bold">=</span> ax, data <span style="color:#000;font-weight:bold">=</span> noise_df_long,
</span></span><span style="display:flex;"><span>             x <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;Sd&#39;</span>, y <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;Accuracy&#39;</span>,
</span></span><span style="display:flex;"><span>             ci <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">100</span>,
</span></span><span style="display:flex;"><span>             hue <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;model&#39;</span>, style <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;model&#34;</span>,
</span></span><span style="display:flex;"><span>             palette <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;colorblind&#39;</span>, linewidth <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">3</span>,
</span></span><span style="display:flex;"><span>    markers<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">True</span>, dashes <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>)
</span></span><span style="display:flex;"><span>ax<span style="color:#000;font-weight:bold">.</span>set_title(<span style="color:#d14">&#39;Accuracy of different models over increasing measurement noise&#39;</span>)
</span></span><span style="display:flex;"><span>ax<span style="color:#000;font-weight:bold">.</span>set(ylabel <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;Accuracy&#39;</span>, xlabel <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;Noise amplitude&#39;</span>)
</span></span></code></pre></div><pre><code>[Text(0, 0.5, 'Accuracy'), Text(0.5, 0, 'Noise amplitude')]
</code></pre>
<p><img src="output_42_1.png" alt="png"></p>




<h2 id="conclusion">Conclusion
  <a href="#conclusion"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>
<p>All models are quite robust, with the accuracy never falling below 96%.
The neural net model seems to be the more robust, reaching a higher accuracy than other models on tricky data despite the rough tuning of its hyper-parameters.
As such, it would probably be my go-to model for future similar species identification tasks.</p>

        
        <details closed class="f6 fw7 input-reset">
  <dl class="f6 lh-copy">
    <dt class="fw7">Posted on:</dt>
    <dd class="fw5 ml0">July 6, 2022</dd>
  </dl>
  <dl class="f6 lh-copy">
    <dt class="fw7">Length:</dt>
    <dd class="fw5 ml0">14 minute read, 2957 words</dd>
  </dl>
  
  
  
  <dl class="f6 lh-copy">
    <dt class="fw7">See Also:</dt>
    
  </dl>
</details>

      </section>
      <footer class="post-footer">
        <div class="post-pagination dt w-100 mt4 mb2">
  
  
  
  
    <a class="next dtc pl2 tr v-top fw6"
    href="https://c-saade.github.io/projects/yelp_api_analysis/">Eating out in Lyon - Data analysis &rarr;</a>
  
</div>

      </footer>
    </article>
    
  </section>
</main>
<footer class="site-footer pv4 bt b--transparent ph5" role="contentinfo">
  <nav class="db dt-l w-100">
    <p class="site-copyright f7 db dtc-l v-mid w-100 w-33-l tc tl-l pv2 pv0-l mv0 lh-copy">
      &copy; 2023 Camille Saade
      <span class="middot-divider"></span>
      Made with <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title"><a xmlns:dct="http://purl.org/dc/terms/" href="https://github.com/hugo-apero/" rel="dct:source">Hugo ApÃ©ro</a></span>.
      <br />
      
Based on <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title"><a xmlns:dct="http://purl.org/dc/terms/" href="https://github.com/formspree/blogophonic-hugo" rel="dct:source">Blogophonic</a></span> by <a xmlns:cc="http://creativecommons.org/ns#" href="https://formspree.io" property="cc:attributionName" rel="cc:attributionURL">Formspree</a>.
    </p>
    
    <div class="site-social-links db dtc-l v-mid w-100 w-33-l tc pv2 pv0-l mv0">
      <div class="social-icon-links" aria-hidden="true">
  
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://www.linkedin.com/in/camille-saade-a21800231/" title="linkedin" target="_blank" rel="me noopener">
      <i class="fab fa-linkedin fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://github.com/c-saade/" title="github" target="_blank" rel="me noopener">
      <i class="fab fa-github fa-lg fa-fw"></i>
    </a>
  
    
    
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://orcid.org/0000-0003-2368-9480" title="orcid" target="_blank" rel="me noopener">
      <i class="ai ai-orcid fa-lg fa-fw"></i>
    </a>
  
</div>

    </div>
    
    <div class="site-links f6 db dtc-l v-mid w-100 w-67-l tc tr-l pv2 pv0-l mv0">
      
    </div>
  </nav>
  
    <script>

    var i, text, code, codes = document.getElementsByTagName('code');
    for (let i = 0; i < codes.length;) {
      code = codes[i];
      if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
        text = code.textContent;
        if (/^\$[^$]/.test(text) && /[^$]\$$/.test(text)) {
          text = text.replace(/^\$/, '\\(').replace(/\$$/, '\\)');
          code.textContent = text;
        }
        if (/^\\\((.|\s)+\\\)$/.test(text) ||
            /^\\\[(.|\s)+\\\]$/.test(text) ||
            /^\$(.|\s)+\$$/.test(text) ||
            /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
          code.outerHTML = code.innerHTML;  
          continue;
        }
      }
      i++;
    }
</script>

  
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css" integrity="sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js" integrity="sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js" integrity="sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>



    
  
  
</footer>

      </div>
    </body>
</html>
